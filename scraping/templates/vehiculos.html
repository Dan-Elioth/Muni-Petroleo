{% extends 'layout.html' %}

{% block title %}Administrar Vehículos{% endblock %}

{% block content %}

<div class="min-w-screen h-screen ">
    <div class="absolute bg-black opacity-80 inset-0"></div>
    <div class="relative flex flex-col items-center justify-center">
        <button onclick="openModal('crearModal')" class="bg-green-600 text-white px-4 py-2 rounded-full mb-4">Agregar Vehículo</button>

        <div class="grid mt-8 gap-8 grid-cols-1 md:grid-cols-2 xl:grid-cols-2">
            {% for vehiculo in vehiculos %}
            <div class="flex flex-col">
                <div class="bg-white shadow-md rounded-3xl p-4">
                    <div class="flex-none lg:flex">
                        <div class="h-full w-full lg:h-48 lg:w-48 lg:mb-0 mb-3">
                            <img src="{{ url_for('static', filename='uploads/' + vehiculo.imagen_url) }}" alt="Vehículo" class="w-full object-cover lg:h-48 rounded-2xl">
                        </div>
                        <div class="flex-auto ml-3 justify-evenly py-2">
                            <div class="flex flex-wrap">
                                <div class="w-full flex-none text-xs text-blue-700 font-medium">{{ vehiculo.marca }}</div>
                                <h2 class="flex-auto text-lg font-medium">{{ vehiculo.modelo }}</h2>
                            </div>
                            <div class="text-sm text-gray-500">Año: {{ vehiculo.anio }}</div>
                            <div class="text-sm text-gray-500">Placa: {{ vehiculo.numero_placa }}</div>
                            <div class="text-sm text-gray-500">Capacidad: {{ vehiculo.capacidad }}</div>
                            <div class="text-sm text-gray-500">Área: {{ vehiculo.area_nombre }}</div>
                            <div class="flex p-4 pb-2 border-t border-gray-200"></div>
                            <div class="flex space-x-3 text-sm font-medium">
                                <button onclick="openEditModal({{ vehiculo.id }}, '{{ vehiculo.modelo }}', '{{ vehiculo.marca }}', '{{ vehiculo.anio }}', '{{ vehiculo.numero_placa }}', '{{ vehiculo.capacidad }}', '{{ vehiculo.area_id }}')" class="bg-gray-900 px-5 py-2 text-white rounded-full">Editar</button>
                                <button onclick="openDeleteModal({{ vehiculo.id }})" class="bg-red-600 px-5 py-2 text-white rounded-full">Eliminar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Modal de Crear Vehículo -->
<div id="crearModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-lg font-bold mb-4">Agregar Vehículo</h2>
        <form action="{{ url_for('crear_vehiculo') }}" method="POST" enctype="multipart/form-data">
            <label>Modelo:</label>
            <input type="text" name="modelo" class="border p-2 w-full mb-2">
            
            <label>Marca:</label>
            <input type="text" name="marca" class="border p-2 w-full mb-2">
            
            <label>Año:</label>
            <input type="number" name="anio" class="border p-2 w-full mb-2">
            
            <label>Número de Placa:</label>
            <input type="text" name="numero_placa" class="border p-2 w-full mb-2">
            
            <label>Capacidad:</label>
            <input type="number" name="capacidad" class="border p-2 w-full mb-2">
            
            <label>Área:</label>
            <select name="area_id" class="border p-2 w-full mb-2">
                {% for area in areas %}
                <option value="{{ area.id }}">{{ area.nombre }}</option>
                {% endfor %}
            </select>

            <label>Imagen:</label>
            <input type="file" name="imagen" class="border p-2 w-full mb-2">

            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
            <button type="button" onclick="closeModal('crearModal')" class="bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
        </form>
    </div>
</div>

<!-- Modal de Editar Vehículo -->
<div id="editarModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-lg font-bold mb-4">Editar Vehículo</h2>
        <form id="editForm" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="id" id="editId">
            
            <label>Modelo:</label>
            <input type="text" name="modelo" id="editModelo" class="border p-2 w-full mb-2">
            
            <label>Marca:</label>
            <input type="text" name="marca" id="editMarca" class="border p-2 w-full mb-2">
            
            <label>Año:</label>
            <input type="number" name="anio" id="editAnio" class="border p-2 w-full mb-2">
            
            <label>Número de Placa:</label>
            <input type="text" name="numero_placa" id="editNumeroPlaca" class="border p-2 w-full mb-2">
            
            <label>Capacidad:</label>
            <input type="number" name="capacidad" id="editCapacidad" class="border p-2 w-full mb-2">
            
            <label>Área:</label>
            <select name="area_id" id="editArea" class="border p-2 w-full mb-2">
                {% for area in areas %}
                <option value="{{ area.id }}">{{ area.nombre }}</option>
                {% endfor %}
            </select>

            <label>Imagen:</label>
            <input type="file" name="imagen" class="border p-2 w-full mb-2">

            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Actualizar</button>
            <button type="button" onclick="closeModal('editarModal')" class="bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
        </form>
    </div>
</div>

<!-- Modal de Confirmación para Eliminar -->
<div id="eliminarModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-lg font-bold mb-4">¿Estás seguro de eliminar?</h2>
        <form id="deleteForm" method="POST">
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded">Eliminar</button>
            <button type="button" onclick="closeModal('eliminarModal')" class="bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
        </form>
    </div>
</div>

<script>
function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
}
function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
}
function openEditModal(id, modelo, marca, anio, numero_placa, capacidad, area_id) {
    document.getElementById("editForm").action = "/vehiculos/editar/" + id;
    document.getElementById("editModelo").value = modelo;
    document.getElementById("editMarca").value = marca;
    document.getElementById("editAnio").value = anio;
    document.getElementById("editNumeroPlaca").value = numero_placa;
    document.getElementById("editCapacidad").value = capacidad;
    document.getElementById("editArea").value = area_id;
    openModal('editarModal');
}
function openDeleteModal(id) {
    document.getElementById("deleteForm").action = "/vehiculos/eliminar/" + id;
    openModal('eliminarModal');
}
</script>

{% endblock %}
